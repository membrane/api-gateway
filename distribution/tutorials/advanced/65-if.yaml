# yaml-language-server: $schema=../../core/target/classes/com/predic8/membrane/core/config/json/membrane.schema.json
#
# Membrane Tutorial: if
#
# 1.) Start Membrane:
#     membrane.sh -c
# 2.) Try the endpoints:
#     curl http://localhost:2000
#     curl http://localhost:2000/foo -H "X-Id: 7"
#     curl http://localhost:2000/get -H "X-Id: 7"

spec:
  port: 2000
  flow:
    - request:
        - if:
            test: header['X-Id'] == null  # default language: spel
            flow:
              - static:
                  src: Please set X-Id header
              - return:
                  statusCode: 400
        - if:
            test: path.startsWith("/foo")
            language: groovy
            flow:
              - log:
                  message: "Foo"
    - response:
        - if:
            test: statusCode matches '4\d\d'
            language: spel
            flow:
              - static:
                  src: User error!
  target:
    url: https://httpbin.org


