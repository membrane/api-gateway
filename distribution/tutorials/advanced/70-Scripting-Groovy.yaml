
# yaml-language-server: $schema=https://www.membrane-api.io/v7.0.0.json
#
# Membrane Tutorial: Groovy Scripting
#
# Try:
#   curl http://localhost:2000/groovy
#   curl http://localhost:2000/random
#   curl http://localhost:2000/response

api:
  port: 2000
  path:
    uri: /groovy
  flow:
    - groovy:
        src: |
          println "I'm executed in the ${flow} flow"
    - return:
        statusCode: 200

---
api:
  port: 2000
  path:
    uri: /random
  flow:
    - groovy:
        src: |
          sites = ["https://api.predic8.de","https://httpbin.org/json","https://bored-api.appbrewery.com/random"]
          Collections.shuffle sites
          exchange.setDestinations(sites)

---
api:
  port: 2000
  path:
    uri: /response
  flow:
    - groovy:
        src: |
          Response.ok()
            .contentType("application/json")
            .header("X-Foo", "bar")
            .body("""
              {
                "success": true
              }
              """)
          .build()

