# yaml-language-server: $schema=https://www.membrane-api.io/v7.1.0.json
#
# Tutorial: GraphQL Protection
#
# Limits the complexity and allowed operations of incoming GraphQL requests.
# Protects from invalid and expensive queries that could lead to denial
# of service or brute force attacks.
#
# Try:
#
# 1.) Valid request => 200
#    curl -d '{"query":"{products{id}}"}' -H "Content-Type: application/json" http://localhost:2000
#
# 2.) Max depth exceeded => 400
#    curl -d '{ "query": "query{categories{products{vendors{id}}}}"}' -H "Content-Type: application/json" http://localhost:2000
#
# 3.) Max recursion exceeded => 400
#    curl -d '{"query":"{products{vendor{products{id}}}}"}' -H "Content-Type: application/json" http://localhost:2000
#
# 4.) Disallowed mutation 'updateCategory' => 400
#    curl -d '{"query":"mutation { updateCategory(id:6,name: \"Dry Fruits\"){id}}"}' -H "Content-Type: application/json" http://localhost:2000
#
# 5.) Disallowed introspection => 400
#    curl -d '{"query":"{ __schema{mutationType {fields{name}}}}"}' -H "Content-Type: application/json" http://localhost:2000
#
# For more examples see: examples/graphql/graphql-validation
#
# Reference: https://www.membrane-api.io/docs/current/graphQLProtection.html

api:
  port: 2000
  flow:
    - request:
        - graphQLProtection:
            maxRecursion: 1
            maxMutations: 5
            maxDepth: 3
            disallow:
              - mutation: updateCategory
              - introspection: {}
  target:
    url: https://www.predic8.de/fruit-shop-graphql

