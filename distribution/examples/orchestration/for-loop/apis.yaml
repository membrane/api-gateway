# yaml-language-server: $schema=https://www.membrane-api.io/v7.1.0.json

api:
  port: 2000
  flow:
    - request:
        - call:
            url: https://api.predic8.de/shop/v2/products?limit=7
        # Iterate over each product to get additional details (price)
        - for:
            in: $.products
            language: jsonpath
            flow:
              - call:
                  url: https://api.predic8.de/shop/v2/products/${property.it['id']}
                  language: spel
              - groovy:
                  src: |
                    property.result = property.result ?: []
                    property.result.add(
                      [ "name": property.it.name,
                        "price": fn.jsonPath('$.price')
                      ])
        # Render a simplified JSON response with only product name and price
        - template:
            contentType: application/json
            pretty: true
            src: |
              {
                  "products": ${property.result}
              }
    - return:
        status: 200

