# yaml-language-server: $schema=https://www.membrane-api.io/v7.1.0.json
# If caller provides a valid API key it will receive a signed JWT.
api:
  port: 2000
  name: Token Server
  flow:
    - apiKey:
        required: true
        stores:
          - apiKeyFileStore:
              location: demo-keys.txt
        extractors:
          - header: {}
    - request:
        - template:
            contentType: application/json
            src: |
              {
                "sub": "user@example.com",
                "aud": "order",
                "scope": ${scopes()}
              }
        - jwtSign:
            jwk:
              location: jwk.json
    - return: {}
---

api:
  port: 2001
  name: Protected Resource
  flow:
    - jwtAuth:
        expectedAud: order
        jwks:
          jwks:
            - location: jwk.json
    - template:
        src: |
          You accessed protected content!
          JWT Scopes: ${property.jwt.get("scope")}
    - return: {}
