# yaml-language-server: $schema=https://www.membrane-api.io/v7.1.0.json

# API key stores are designed to retrieve key and scope data from various data sources.
# In this instance, we use an `ApiKeyFileStore`, which fetches API keys from a specified file.
# For global access across all API key interceptors, declare the stores as shown here.
# If an interceptor-specific store is needed, embed the store directly within the interceptor.

components:
  keys:
    apiKeyFileStore:
      location: ./demo-keys.txt

---
global:
  - apiKey:
      # API key authorization is optional.
      # But certain scopes allow for additional access rights.
      required: false
      extractors:
        - header:
            name: X-Key

---
api:
  port: 2000
  flow:
    - request:
      - log:
          message: "Scopes: ${scopes()}"
      - if:
          test: hasScope('admin')
          flow:
            - template:
                src: |
                  Only admins!
                  Scopes: ${scopes()}
            - return:
                status: 200
      - if:
          test: hasScope('finance') or hasScope('accounting')
          flow:
            - template:
                src: |
                  Only finance or accounting!
                  Scopes: ${scopes()}
            - return:
                status: 200
      - template:
          src: Normal API
      - return:
          status: 200

