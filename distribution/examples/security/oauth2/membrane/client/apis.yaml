# yaml-language-server: $schema=https://www.membrane-api.io/v7.1.0.json
api:
  port: 2000
  flow:
    # Protects a resource with OAuth2 - blocks on invalid login
    - oauth2Resource2:
        membrane:
          src: http://localhost:8000
          clientId: abc
          clientSecret: def
          scope: openid profile
          claims: username
          claimsIdt: sub
    - request:
        # Forward the authenticated userâ€™s email to the backend in an HTTP header.
        - setHeader:
            name: X-EMAIL
            value: ${property['membrane.oauth2'].userinfo['email']}
  target:
    url: http://localhost:3000

---
api:
  port: 3000
  flow:
    - request:
        - template:
            src: You accessed the protected resource! Hello ${header["X-EMAIL"]}
        - return:
            status: 200

---
api:
  port: 9001
  flow:
    - adminConsole: {}
