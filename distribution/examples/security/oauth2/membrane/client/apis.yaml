
# yaml-language-server: $schema=https://www.membrane-api.io/v7.0.0.json
api:
  name: Resource Server
  port: 2000
  flow:
    - log: {}
    # Protects a resource with OAuth2 - blocks on invalid login
    - oauth2Resource2:
        membrane:
          src: http://localhost:8000
          clientId: abc
          clientSecret: def
          scope: openid profile
          claims: username
          claimsIdt: sub
    # Use the information from the authentication server and pass it to the resource server (optional)
    - groovy:
        src: |
          def oauth2 = exc.properties.'membrane.oauth2'
          // Put the eMail into the header X-EMAIL and pass it to the protected server.
          exc.request.header.setValue('X-EMAIL',oauth2.userinfo.email)
          CONTINUE
  target:
    host: localhost
    port: 3000

---

api:
  port: 3000
  flow:
    - groovy:
        src: |
          exc.setResponse(Response.ok("You accessed the protected resource! Hello " + exc.request.header.getFirstValue("X-EMAIL")).build())
          RETURN

---

api:
  port: 9001
  flow:
    - adminConsole: {}