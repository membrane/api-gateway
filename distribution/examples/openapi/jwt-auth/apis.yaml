# yaml-language-server: $schema=https://www.membrane-api.io/v7.1.0.json
api:
  name: Token Server
  port: 2000
  flow:
    - request:
        - template:
            src: |
              {
                "sub": "user@example.com",
                "aud": "shop",
                "scp": "inventory"
              }
        - jwtSign:
            jwk:
              location: jwk.json
    - return: {}

---

api:
  name: Protected API
  port: 2001
  openapi:
    - location: secure-shop-api.yml
      validateSecurity: true
  flow:
    - jwtAuth:
        expectedAud: shop
        jwks:
          jwks:
            - location: jwk.json
    - openapiValidator: {}
