# yaml-language-server: $schema=https://www.membrane-api.io/v6.3.11.json
# Endpoint can accept request from old and new clients
api:
  port: 2000
  flow:
    - request:
        # If it is a request with the old namespace convert it to the new
        - if:
            test: //*[namespace-uri() = 'https://predic8.de/old']
            language: xpath
            flow:
              - transform:
                  xslt: convert-request-to-new-version.xslt
              # Mark as converted
              - setProperty:
                  name: converted
                  value: true
    - response:
        #  When it was converted transform response body back to old
        - if:
            test: properties['converted'] == 'true'
            flow:
              - transform:
                  xslt: convert-response-to-old-version.xslt
    # SOAP service implementation for new version
    - sampleSoapService: {}